{"remainingRequest":"/Users/zhangsir/Desktop/muise/node_modules/babel-loader/lib/index.js!/Users/zhangsir/Desktop/muise/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/zhangsir/Desktop/muise/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/zhangsir/Desktop/muise/src/components/search.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/zhangsir/Desktop/muise/src/components/search.vue","mtime":1592641032490},{"path":"/Users/zhangsir/Desktop/muise/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/zhangsir/Desktop/muise/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/zhangsir/Desktop/muise/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/zhangsir/Desktop/muise/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es7.object.get-own-property-descriptors\";\nimport \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.object.keys\";\nimport \"core-js/modules/es6.array.find\";\nimport \"core-js/modules/es6.function.name\";\nimport _defineProperty from \"/Users/zhangsir/Desktop/muise/node_modules/@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport \"regenerator-runtime/runtime\";\nimport _asyncToGenerator from \"/Users/zhangsir/Desktop/muise/node_modules/@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(source, true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(source).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport storage from \"good-storage\";\nimport { mapActions, mapMutations } from \"@/store/helper/music\";\nimport { getSearchHot, getSearchSuggest } from \"@/api\";\nimport { createSong, genArtistisText, debounce } from \"@/utils\";\nvar SEARCH_HISTORY_KEY = \"__search_history__\";\nexport default {\n  created: function () {\n    var _created = _asyncToGenerator(\n    /*#__PURE__*/\n    regeneratorRuntime.mark(function _callee() {\n      var _ref, hots;\n\n      return regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return getSearchHot();\n\n            case 2:\n              _ref = _context.sent;\n              hots = _ref.result.hots;\n              this.searchHots = hots;\n\n            case 5:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, this);\n    }));\n\n    function created() {\n      return _created.apply(this, arguments);\n    }\n\n    return created;\n  }(),\n  data: function data() {\n    return {\n      searchPanelShow: false,\n      searchKeyword: \"\",\n      searchHots: [],\n      searchHistorys: storage.get(SEARCH_HISTORY_KEY, []),\n      suggest: {},\n      reserveDoms: []\n    };\n  },\n  methods: _objectSpread({\n    onClickInput: function onClickInput() {\n      this.searchPanelShow = true;\n    },\n    onBlur: function onBlur() {\n      this.searchPanelShow = false;\n    },\n    onInput: debounce(function (value) {\n      var _this = this;\n\n      if (!value.trim()) {\n        return;\n      }\n\n      getSearchSuggest(value).then(function (_ref2) {\n        var result = _ref2.result;\n        _this.suggest = result;\n      });\n    }, 500),\n    onClickHot: function onClickHot(hot) {\n      var first = hot.first;\n      this.goSearch(first);\n    },\n    onEnterPress: function onEnterPress() {\n      if (this.searchKeyword) {\n        this.goSearch(this.searchKeyword);\n      }\n    },\n    goSearch: function goSearch(keywords) {\n      this.searchHistorys.push({\n        first: keywords\n      });\n      storage.set(SEARCH_HISTORY_KEY, this.searchHistorys);\n      this.$router.push(\"/search/\".concat(keywords));\n      this.searchPanelShow = false;\n    },\n    onClickSong: function () {\n      var _onClickSong = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee2(item) {\n        var id, name, artists, duration, mvid, _item$album, albumId, albumName, song;\n\n        return regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                id = item.id, name = item.name, artists = item.artists, duration = item.duration, mvid = item.mvid, _item$album = item.album, albumId = _item$album.id, albumName = _item$album.name;\n                song = createSong({\n                  id: id,\n                  name: name,\n                  artists: artists,\n                  duration: duration,\n                  albumId: albumId,\n                  albumName: albumName,\n                  mvId: mvid\n                });\n                this.startSong(song);\n                this.addToPlaylist(song);\n\n              case 4:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function onClickSong(_x) {\n        return _onClickSong.apply(this, arguments);\n      }\n\n      return onClickSong;\n    }(),\n    onClickPlaylist: function onClickPlaylist(item) {\n      var id = item.id;\n      this.$router.push(\"/playlist/\".concat(id));\n      this.searchPanelShow = false;\n    },\n    onClickMv: function onClickMv(mv) {\n      var id = mv.id;\n      this.$router.push(\"/mv/\".concat(id));\n    }\n  }, mapMutations([\"setPlaylist\"]), {}, mapActions([\"startSong\", \"addToPlaylist\"])),\n  computed: {\n    suggestShow: function suggestShow() {\n      var _this2 = this;\n\n      return this.searchKeyword.length && [\"songs\", \"playlists\"].find(function (key) {\n        return _this2.suggest[key] && _this2.suggest[key].length;\n      });\n    },\n    normalizedSuggests: function normalizedSuggests() {\n      return [{\n        title: \"单曲\",\n        icon: \"music\",\n        data: this.suggest.songs,\n        renderName: function renderName(song) {\n          return \"\".concat(song.name, \" - \").concat(genArtistisText(song.artists));\n        },\n        onClick: this.onClickSong.bind(this)\n      }, {\n        title: \"歌单\",\n        icon: \"playlist\",\n        data: this.suggest.playlists,\n        onClick: this.onClickPlaylist.bind(this)\n      }, {\n        title: \"mv\",\n        icon: \"mv\",\n        data: this.suggest.mvs,\n        renderName: function renderName(mv) {\n          return \"\".concat(mv.name, \" - \").concat(genArtistisText(mv.artists));\n        },\n        onClick: this.onClickMv.bind(this)\n      }].filter(function (item) {\n        return item.data && item.data.length;\n      });\n    }\n  }\n};",{"version":3,"sources":["search.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA0FA,OAAA,OAAA,MAAA,cAAA;AACA,SAAA,UAAA,EAAA,YAAA,QAAA,sBAAA;AACA,SAAA,YAAA,EAAA,gBAAA,QAAA,OAAA;AACA,SAAA,UAAA,EAAA,eAAA,EAAA,QAAA,QAAA,SAAA;AAEA,IAAA,kBAAA,GAAA,oBAAA;AACA,eAAA;AACA,EAAA,OADA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qBAIA,YAAA,EAJA;;AAAA;AAAA;AAGA,cAAA,IAHA,QAGA,MAHA,CAGA,IAHA;AAKA,mBAAA,UAAA,GAAA,IAAA;;AALA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAOA,EAAA,IAPA,kBAOA;AACA,WAAA;AACA,MAAA,eAAA,EAAA,KADA;AAEA,MAAA,aAAA,EAAA,EAFA;AAGA,MAAA,UAAA,EAAA,EAHA;AAIA,MAAA,cAAA,EAAA,OAAA,CAAA,GAAA,CAAA,kBAAA,EAAA,EAAA,CAJA;AAKA,MAAA,OAAA,EAAA,EALA;AAMA,MAAA,WAAA,EAAA;AANA,KAAA;AAQA,GAhBA;AAiBA,EAAA,OAAA;AACA,IAAA,YADA,0BACA;AACA,WAAA,eAAA,GAAA,IAAA;AACA,KAHA;AAIA,IAAA,MAJA,oBAIA;AACA,WAAA,eAAA,GAAA,KAAA;AACA,KANA;AAOA,IAAA,OAAA,EAAA,QAAA,CAAA,UAAA,KAAA,EAAA;AAAA;;AACA,UAAA,CAAA,KAAA,CAAA,IAAA,EAAA,EAAA;AACA;AACA;;AACA,MAAA,gBAAA,CAAA,KAAA,CAAA,CAAA,IAAA,CAAA,iBAAA;AAAA,YAAA,MAAA,SAAA,MAAA;AACA,QAAA,KAAA,CAAA,OAAA,GAAA,MAAA;AACA,OAFA;AAGA,KAPA,EAOA,GAPA,CAPA;AAeA,IAAA,UAfA,sBAeA,GAfA,EAeA;AAAA,UACA,KADA,GACA,GADA,CACA,KADA;AAEA,WAAA,QAAA,CAAA,KAAA;AACA,KAlBA;AAmBA,IAAA,YAnBA,0BAmBA;AACA,UAAA,KAAA,aAAA,EAAA;AACA,aAAA,QAAA,CAAA,KAAA,aAAA;AACA;AACA,KAvBA;AAwBA,IAAA,QAxBA,oBAwBA,QAxBA,EAwBA;AACA,WAAA,cAAA,CAAA,IAAA,CAAA;AAAA,QAAA,KAAA,EAAA;AAAA,OAAA;AACA,MAAA,OAAA,CAAA,GAAA,CAAA,kBAAA,EAAA,KAAA,cAAA;AACA,WAAA,OAAA,CAAA,IAAA,mBAAA,QAAA;AACA,WAAA,eAAA,GAAA,KAAA;AACA,KA7BA;AA8BA,IAAA,WA9BA;AAAA;AAAA;AAAA,gDA8BA,IA9BA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAgCA,gBAAA,EAhCA,GAsCA,IAtCA,CAgCA,EAhCA,EAiCA,IAjCA,GAsCA,IAtCA,CAiCA,IAjCA,EAkCA,OAlCA,GAsCA,IAtCA,CAkCA,OAlCA,EAmCA,QAnCA,GAsCA,IAtCA,CAmCA,QAnCA,EAoCA,IApCA,GAsCA,IAtCA,CAoCA,IApCA,gBAsCA,IAtCA,CAqCA,KArCA,EAqCA,OArCA,eAqCA,EArCA,EAqCA,SArCA,eAqCA,IArCA;AAuCA,gBAAA,IAvCA,GAuCA,UAAA,CAAA;AACA,kBAAA,EAAA,EAAA,EADA;AAEA,kBAAA,IAAA,EAAA,IAFA;AAGA,kBAAA,OAAA,EAAA,OAHA;AAIA,kBAAA,QAAA,EAAA,QAJA;AAKA,kBAAA,OAAA,EAAA,OALA;AAMA,kBAAA,SAAA,EAAA,SANA;AAOA,kBAAA,IAAA,EAAA;AAPA,iBAAA,CAvCA;AAgDA,qBAAA,SAAA,CAAA,IAAA;AACA,qBAAA,aAAA,CAAA,IAAA;;AAjDA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAmDA,IAAA,eAnDA,2BAmDA,IAnDA,EAmDA;AAAA,UACA,EADA,GACA,IADA,CACA,EADA;AAEA,WAAA,OAAA,CAAA,IAAA,qBAAA,EAAA;AACA,WAAA,eAAA,GAAA,KAAA;AACA,KAvDA;AAwDA,IAAA,SAxDA,qBAwDA,EAxDA,EAwDA;AAAA,UACA,EADA,GACA,EADA,CACA,EADA;AAEA,WAAA,OAAA,CAAA,IAAA,eAAA,EAAA;AACA;AA3DA,KA4DA,YAAA,CAAA,CAAA,aAAA,CAAA,CA5DA,MA6DA,UAAA,CAAA,CAAA,WAAA,EAAA,eAAA,CAAA,CA7DA,CAjBA;AAgFA,EAAA,QAAA,EAAA;AACA,IAAA,WADA,yBACA;AAAA;;AACA,aACA,KAAA,aAAA,CAAA,MAAA,IACA,CAAA,OAAA,EAAA,WAAA,EAAA,IAAA,CAAA,UAAA,GAAA,EAAA;AACA,eAAA,MAAA,CAAA,OAAA,CAAA,GAAA,KAAA,MAAA,CAAA,OAAA,CAAA,GAAA,EAAA,MAAA;AACA,OAFA,CAFA;AAMA,KARA;AASA,IAAA,kBATA,gCASA;AACA,aAAA,CACA;AACA,QAAA,KAAA,EAAA,IADA;AAEA,QAAA,IAAA,EAAA,OAFA;AAGA,QAAA,IAAA,EAAA,KAAA,OAAA,CAAA,KAHA;AAIA,QAAA,UAJA,sBAIA,IAJA,EAIA;AACA,2BAAA,IAAA,CAAA,IAAA,gBAAA,eAAA,CAAA,IAAA,CAAA,OAAA,CAAA;AACA,SANA;AAOA,QAAA,OAAA,EAAA,KAAA,WAAA,CAAA,IAAA,CAAA,IAAA;AAPA,OADA,EAUA;AACA,QAAA,KAAA,EAAA,IADA;AAEA,QAAA,IAAA,EAAA,UAFA;AAGA,QAAA,IAAA,EAAA,KAAA,OAAA,CAAA,SAHA;AAIA,QAAA,OAAA,EAAA,KAAA,eAAA,CAAA,IAAA,CAAA,IAAA;AAJA,OAVA,EAgBA;AACA,QAAA,KAAA,EAAA,IADA;AAEA,QAAA,IAAA,EAAA,IAFA;AAGA,QAAA,IAAA,EAAA,KAAA,OAAA,CAAA,GAHA;AAIA,QAAA,UAJA,sBAIA,EAJA,EAIA;AACA,2BAAA,EAAA,CAAA,IAAA,gBAAA,eAAA,CAAA,EAAA,CAAA,OAAA,CAAA;AACA,SANA;AAOA,QAAA,OAAA,EAAA,KAAA,SAAA,CAAA,IAAA,CAAA,IAAA;AAPA,OAhBA,EAyBA,MAzBA,CAyBA,UAAA,IAAA;AAAA,eAAA,IAAA,CAAA,IAAA,IAAA,IAAA,CAAA,IAAA,CAAA,MAAA;AAAA,OAzBA,CAAA;AA0BA;AApCA;AAhFA,CAAA","sourcesContent":["<template>\n  <div class=\"search\">\n    <el-input\n      @click.native=\"onClickInput\"\n      @input=\"onInput\"\n      @keypress.native.enter=\"onEnterPress\"\n      placeholder=\"搜索\"\n      prefix-icon=\"el-icon-search\"\n      ref=\"input\"\n      v-model.trim=\"searchKeyword\"\n    ></el-input>\n    <Toggle\n      :reserveDoms=\"[$refs.input && $refs.input.$el]\"\n      :show.sync=\"searchPanelShow\"\n    >\n      <div\n        class=\"search-panel\"\n        v-show=\"searchPanelShow\"\n      >\n        <div\n          class=\"search-suggest\"\n          v-if=\"suggestShow\"\n        >\n          <div\n            :key=\"index\"\n            class=\"suggest-item\"\n            v-for=\"(normalizedSuggest, index) in normalizedSuggests\"\n          >\n            <div class=\"title\">\n              <Icon\n                :size=\"12\"\n                :type=\"normalizedSuggest.icon\"\n              />\n              {{normalizedSuggest.title}}\n            </div>\n            <ul class=\"list\">\n              <li\n                :key=\"item.id\"\n                @click=\"normalizedSuggest.onClick(item)\"\n                class=\"item\"\n                v-for=\"item in normalizedSuggest.data\"\n              >\n                <HighlightText\n                  :highlightText=\"searchKeyword\"\n                  :text=\"normalizedSuggest.renderName ? normalizedSuggest.renderName(item) : item.name\"\n                />\n              </li>\n            </ul>\n          </div>\n        </div>\n        <div\n          class=\"search-hots\"\n          v-else\n        >\n          <div class=\"block\">\n            <p class=\"title\">热门搜索</p>\n            <div class=\"tags\">\n              <NButton\n                :key=\"index\"\n                @click=\"onClickHot(hot)\"\n                class=\"button\"\n                v-for=\"(hot, index) in searchHots\"\n              >{{hot.first}}</NButton>\n            </div>\n          </div>\n          <div class=\"block\">\n            <p class=\"title\">搜索历史</p>\n            <div\n              class=\"tags\"\n              v-if=\"searchHistorys.length\"\n            >\n              <NButton\n                :key=\"index\"\n                @click=\"onClickHot(history)\"\n                class=\"button\"\n                v-for=\"(history, index) in searchHistorys\"\n              >{{history.first}}</NButton>\n            </div>\n            <div\n              class=\"empty\"\n              v-else\n            >暂无搜索历史</div>\n          </div>\n        </div>\n      </div>\n    </Toggle>\n  </div>\n</template>\n\n<script type=\"text/ecmascript-6\">\nimport storage from \"good-storage\"\nimport { mapActions, mapMutations } from \"@/store/helper/music\"\nimport { getSearchHot, getSearchSuggest } from \"@/api\"\nimport { createSong, genArtistisText, debounce } from \"@/utils\"\n\nconst SEARCH_HISTORY_KEY = \"__search_history__\"\nexport default {\n  async created() {\n    const {\n      result: { hots }\n    } = await getSearchHot()\n    this.searchHots = hots\n  },\n  data() {\n    return {\n      searchPanelShow: false,\n      searchKeyword: \"\",\n      searchHots: [],\n      searchHistorys: storage.get(SEARCH_HISTORY_KEY, []),\n      suggest: {},\n      reserveDoms: []\n    }\n  },\n  methods: {\n    onClickInput() {\n      this.searchPanelShow = true\n    },\n    onBlur() {\n      this.searchPanelShow = false\n    },\n    onInput: debounce(function(value) {\n      if (!value.trim()) {\n        return\n      }\n      getSearchSuggest(value).then(({ result }) => {\n        this.suggest = result\n      })\n    }, 500),\n    onClickHot(hot) {\n      const { first } = hot\n      this.goSearch(first)\n    },\n    onEnterPress() {\n      if (this.searchKeyword) {\n        this.goSearch(this.searchKeyword)\n      }\n    },\n    goSearch(keywords) {\n      this.searchHistorys.push({ first: keywords })\n      storage.set(SEARCH_HISTORY_KEY, this.searchHistorys)\n      this.$router.push(`/search/${keywords}`)\n      this.searchPanelShow = false\n    },\n    async onClickSong(item) {\n      const {\n        id,\n        name,\n        artists,\n        duration,\n        mvid,\n        album: { id: albumId, name: albumName }\n      } = item\n      const song = createSong({\n        id,\n        name,\n        artists,\n        duration,\n        albumId,\n        albumName,\n        mvId: mvid\n      })\n      this.startSong(song)\n      this.addToPlaylist(song)\n    },\n    onClickPlaylist(item) {\n      const { id } = item\n      this.$router.push(`/playlist/${id}`)\n      this.searchPanelShow = false\n    },\n    onClickMv(mv) {\n      const { id } = mv\n      this.$router.push(`/mv/${id}`)\n    },\n    ...mapMutations([\"setPlaylist\"]),\n    ...mapActions([\"startSong\", \"addToPlaylist\"])\n  },\n  computed: {\n    suggestShow() {\n      return (\n        this.searchKeyword.length &&\n        [\"songs\", \"playlists\"].find(key => {\n          return this.suggest[key] && this.suggest[key].length\n        })\n      )\n    },\n    normalizedSuggests() {\n      return [\n        {\n          title: \"单曲\",\n          icon: \"music\",\n          data: this.suggest.songs,\n          renderName(song) {\n            return `${song.name} - ${genArtistisText(song.artists)}`\n          },\n          onClick: this.onClickSong.bind(this)\n        },\n        {\n          title: \"歌单\",\n          icon: \"playlist\",\n          data: this.suggest.playlists,\n          onClick: this.onClickPlaylist.bind(this)\n        },\n        {\n          title: \"mv\",\n          icon: \"mv\",\n          data: this.suggest.mvs,\n          renderName(mv) {\n            return `${mv.name} - ${genArtistisText(mv.artists)}`\n          },\n          onClick: this.onClickMv.bind(this)\n        }\n      ].filter(item => item.data && item.data.length)\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.search {\n  position: relative;\n  width: 150px;\n\n  .search-panel {\n    position: fixed;\n    top: $header-height;\n    bottom: $mini-player-height;\n    right: 0;\n    width: 350px;\n    background: var(--search-bgcolor);\n    z-index: $search-panel-z-index;\n    font-size: $font-size-sm;\n    overflow-y: auto;\n    @include box-shadow;\n\n    .block {\n      padding: 16px 24px;\n\n      .title {\n        color: var(--font-color-grey);\n        margin-bottom: 16px;\n      }\n      .tags {\n        display: flex;\n        flex-wrap: wrap;\n\n        .button {\n          margin-bottom: 12px;\n          margin-right: 6px;\n          font-size: $font-size-sm;\n        }\n      }\n\n      .empty {\n        @include flex-center();\n        color: var(--font-color-grey);\n        font-size: $font-size;\n        height: 100px;\n      }\n    }\n\n    .suggest-item {\n      margin-bottom: 16px;\n\n      .title {\n        margin: 16px 8px 8px;\n        color: var(--font-color-grey-shallow);\n      }\n\n      .list {\n        .item {\n          padding: 12px 24px;\n          cursor: pointer;\n          @include text-ellipsis();\n\n          &:hover {\n            background: var(--light-bgcolor);\n          }\n        }\n      }\n    }\n  }\n}\n</style>\n"],"sourceRoot":"src/components"}]}