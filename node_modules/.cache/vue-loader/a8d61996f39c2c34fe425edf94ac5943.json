{"remainingRequest":"/Users/zhangsir/Desktop/ymyu/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/zhangsir/Desktop/ymyu/src/page/mv/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/zhangsir/Desktop/ymyu/src/page/mv/index.vue","mtime":1592641032492},{"path":"/Users/zhangsir/Desktop/ymyu/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/zhangsir/Desktop/ymyu/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/zhangsir/Desktop/ymyu/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { getMvDetail, getMvUrl, getArtists, getSimiMv } from \"@/api\"\nimport { hideMenuMixin } from \"@/utils\"\nimport { mapMutations } from \"@/store/helper/music\"\nimport Comments from \"@/components/comments\"\nimport MvCard from \"@/components/mv-card\"\n\nexport default {\n  mixins: [hideMenuMixin],\n  props: {\n    id: {\n      type: Number,\n      required: true\n    }\n  },\n  metaInfo() {\n    return {\n      title: this.mvDetail.name\n    }\n  },\n  created() {\n    this.init()\n  },\n  data() {\n    return {\n      mvDetail: {},\n      mvPlayInfo: \"\",\n      artist: {},\n      simiMvs: []\n    }\n  },\n  methods: {\n    async init() {\n      const [\n        { data: mvDetail },\n        { data: mvPlayInfo },\n        { mvs: simiMvs }\n      ] = await Promise.all([\n        getMvDetail(this.id),\n        getMvUrl(this.id),\n        getSimiMv(this.id)\n      ])\n      const { artist } = await getArtists(mvDetail.artistId)\n\n      this.mvDetail = mvDetail\n      this.mvPlayInfo = mvPlayInfo\n      this.artist = artist\n      this.simiMvs = simiMvs\n\n      this.$nextTick(() => {\n        const player = this.$refs.video.player\n        // 加载高清源\n        player.emit(\"resourceReady\", genResource(this.mvDetail.brs, mvPlayInfo))\n        player.on(\"play\", () => {\n          // 停止播放歌曲\n          this.setPlayingState(false)\n        })\n      })\n    },\n    goMv(id) {\n      this.$router.push(`/mv/${id}`)\n    },\n    ...mapMutations([\"setPlayingState\"])\n  },\n  watch: {\n    id: \"init\"\n  },\n  components: { Comments, MvCard }\n}\n\nfunction genResource(brs, mvPlayInfo) {\n  const { url: mvPlayInfoUrl, r: mvPlayInfoBr } = mvPlayInfo\n  const keyNameMap = {\n    \"240\": \"标清\",\n    \"480\": \"高清\",\n    \"720\": \"超清\",\n    \"1080\": \"1080P\"\n  }\n\n  return Object.keys(brs).map(key => {\n    // 优先使用mvPlayInfo里的数据\n    const findPreferUrl = key === mvPlayInfoBr\n    const name = keyNameMap[key]\n    const url = findPreferUrl ? mvPlayInfoUrl : brs[key]\n    return {\n      url,\n      name\n    }\n  })\n}\n",{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA2DA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/page/mv","sourcesContent":["// mv详情页面\n<template>\n  <div class=\"mv\" v-if=\"$utils.isDef(mvDetail.id)\">\n    <div class=\"mv-content\">\n      <div class=\"left\">\n        <p class=\"title\">mv详情</p>\n\n        <div class=\"player\">\n          <VideoPlayer :url=\"mvPlayInfo.url\" ref=\"video\" />\n        </div>\n\n        <div class=\"author-wrap\">\n          <div class=\"avatar\">\n            <img v-lazy=\"$utils.genImgUrl(artist.picUrl, 120)\" />\n          </div>\n          <p class=\"author\">{{ artist.name }}</p>\n        </div>\n\n        <p class=\"name\">{{ mvDetail.name }}</p>\n\n        <div class=\"desc\">\n          <span class=\"date\"\n            >发布：{{\n              $utils.formatDate(mvDetail.publishTime, \"yyyy-MM-dd\")\n            }}</span\n          >\n          <span class=\"count\">播放：{{ mvDetail.playCount }}次</span>\n        </div>\n\n        <div class=\"comments\">\n          <Comments :id=\"id\" type=\"mv\" />\n        </div>\n      </div>\n      <div class=\"right\">\n        <p class=\"title\">相关推荐</p>\n        <div class=\"simi-mvs\">\n          <Card\n            :desc=\"`by ${simiMv.artistName}`\"\n            :key=\"simiMv.id\"\n            :name=\"simiMv.name\"\n            @click=\"$utils.goMv(simiMv.id)\"\n            class=\"simi-mv-card\"\n            v-for=\"simiMv in simiMvs\"\n          >\n            <template #img-wrap>\n              <MvCard\n                :duration=\"simiMv.duration\"\n                :img=\"simiMv.cover\"\n                :playCount=\"simiMv.playCount\"\n              />\n            </template>\n          </Card>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script type=\"text/ecmascript-6\">\nimport { getMvDetail, getMvUrl, getArtists, getSimiMv } from \"@/api\"\nimport { hideMenuMixin } from \"@/utils\"\nimport { mapMutations } from \"@/store/helper/music\"\nimport Comments from \"@/components/comments\"\nimport MvCard from \"@/components/mv-card\"\n\nexport default {\n  mixins: [hideMenuMixin],\n  props: {\n    id: {\n      type: Number,\n      required: true\n    }\n  },\n  metaInfo() {\n    return {\n      title: this.mvDetail.name\n    }\n  },\n  created() {\n    this.init()\n  },\n  data() {\n    return {\n      mvDetail: {},\n      mvPlayInfo: \"\",\n      artist: {},\n      simiMvs: []\n    }\n  },\n  methods: {\n    async init() {\n      const [\n        { data: mvDetail },\n        { data: mvPlayInfo },\n        { mvs: simiMvs }\n      ] = await Promise.all([\n        getMvDetail(this.id),\n        getMvUrl(this.id),\n        getSimiMv(this.id)\n      ])\n      const { artist } = await getArtists(mvDetail.artistId)\n\n      this.mvDetail = mvDetail\n      this.mvPlayInfo = mvPlayInfo\n      this.artist = artist\n      this.simiMvs = simiMvs\n\n      this.$nextTick(() => {\n        const player = this.$refs.video.player\n        // 加载高清源\n        player.emit(\"resourceReady\", genResource(this.mvDetail.brs, mvPlayInfo))\n        player.on(\"play\", () => {\n          // 停止播放歌曲\n          this.setPlayingState(false)\n        })\n      })\n    },\n    goMv(id) {\n      this.$router.push(`/mv/${id}`)\n    },\n    ...mapMutations([\"setPlayingState\"])\n  },\n  watch: {\n    id: \"init\"\n  },\n  components: { Comments, MvCard }\n}\n\nfunction genResource(brs, mvPlayInfo) {\n  const { url: mvPlayInfoUrl, r: mvPlayInfoBr } = mvPlayInfo\n  const keyNameMap = {\n    \"240\": \"标清\",\n    \"480\": \"高清\",\n    \"720\": \"超清\",\n    \"1080\": \"1080P\"\n  }\n\n  return Object.keys(brs).map(key => {\n    // 优先使用mvPlayInfo里的数据\n    const findPreferUrl = key === mvPlayInfoBr\n    const name = keyNameMap[key]\n    const url = findPreferUrl ? mvPlayInfoUrl : brs[key]\n    return {\n      url,\n      name\n    }\n  })\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.mv {\n  padding: $page-padding;\n\n  .title {\n    margin-bottom: 16px;\n    font-size: $font-size-lg;\n    font-weight: $font-weight-bold;\n  }\n\n  .mv-content {\n    display: flex;\n    max-width: 950px;\n    margin: auto;\n\n    .left {\n      flex: 1;\n\n      .player {\n        margin-bottom: 16px;\n        overflow: hidden;\n        border-radius: 4px;\n      }\n\n      .author-wrap {\n        display: flex;\n        align-items: center;\n        margin-bottom: 32px;\n\n        .avatar {\n          @include img-wrap(60px);\n          margin-right: 8px;\n          img {\n            @include round(60px);\n          }\n        }\n\n        .author {\n          font-size: $font-size-lg;\n        }\n      }\n\n      .name {\n        margin-bottom: 16px;\n        font-size: $font-size-title-lg;\n        font-weight: $font-weight-bold;\n      }\n\n      .desc {\n        display: flex;\n        color: var(--font-color-grey-shallow);\n        font-size: $font-size-sm;\n\n        .date {\n          display: inline-block;\n          margin-right: 24px;\n        }\n      }\n\n      .comments {\n        margin-top: 48px;\n      }\n    }\n\n    .right {\n      width: 36%;\n      padding-left: 32px;\n\n      .simi-mvs {\n        padding: -8px 0;\n\n        .simi-mv-card {\n          padding: 8px 0;\n        }\n      }\n    }\n  }\n}\n</style>\n"]}]}